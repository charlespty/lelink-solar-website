╔══════════════════════════════════════════════════════════════╗
║  🚀 Lelink Solar 后台管理系统 - 从零开始部署                    ║
║  适用于：项目目录不存在的情况                                   ║
╚══════════════════════════════════════════════════════════════╝

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 第一步：创建项目目录并克隆代码
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

复制以下命令到服务器执行：

cd /var/www && \
echo "📍 当前目录: $(pwd)" && \
echo "" && \
echo "📥 克隆项目代码..." && \
git clone https://github.com/charlespty/lelink-solar-website.git && \
echo "✅ 克隆完成" && \
cd lelink-solar-website && \
echo "📍 进入项目目录: $(pwd)" && \
ls -la && \
echo ""

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 第二步：配置和构建项目
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

确认第一步成功后，继续执行：

echo "💾 备份配置文件..." && \
cp next.config.js next.config.js.backup && \
echo "✅ 备份完成" && \
echo "" && \
echo "🔧 修改配置（启用API支持）..." && \
sed -i "s/output: 'export',/\/\/ output: 'export', \/\/ 后台需要API/" next.config.js && \
sed -i "s/trailingSlash: true,/\/\/ trailingSlash: true,/" next.config.js && \
echo "✅ 配置已修改" && \
echo "" && \
echo "📦 安装依赖（可能需要2-5分钟）..." && \
npm install && \
echo "✅ 依赖安装完成" && \
echo "" && \
echo "🏗️  构建项目（需要1-3分钟）..." && \
npm run build && \
echo "✅ 构建完成" && \
echo ""

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 第三步：启动应用
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

构建成功后，启动应用：

echo "🔄 清理旧进程（如果有）..." && \
pm2 delete all 2>/dev/null || echo "（无旧进程）" && \
echo "" && \
echo "🚀 启动应用..." && \
pm2 start npm --name "lelink-admin" -- start && \
echo "" && \
echo "💾 保存PM2配置..." && \
pm2 save && \
pm2 startup && \
echo "" && \
echo "📊 应用状态：" && \
pm2 status && \
echo "" && \
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━" && \
echo "🎉 部署完成！" && \
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━" && \
echo "" && \
echo "📱 访问地址：" && \
echo "   http://172.233.148.191:3000/admin/login" && \
echo "" && \
echo "🔐 登录信息：" && \
echo "   用户名: admin" && \
echo "   密码: admin123" && \
echo ""

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 完成检查
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

执行以下命令检查一切是否正常：

pm2 logs lelink-admin --lines 20

如果看到类似这样的输出，说明成功了：
> lelink-admin | ▲ Next.js 15.x.x
> lelink-admin | - Local:        http://localhost:3000
> lelink-admin | ✓ Ready in 2.3s

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔍 故障排查
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

如果 git clone 失败：
└─ 检查服务器是否能访问GitHub：ping github.com

如果 npm install 失败：
└─ 检查Node.js版本：node --version（需要 >= 18）
└─ 检查npm版本：npm --version
└─ 清理缓存：npm cache clean --force

如果 npm run build 失败：
└─ 检查磁盘空间：df -h
└─ 查看详细错误信息
└─ 尝试：rm -rf node_modules && npm install

如果 pm2 start 失败：
└─ 查看日志：pm2 logs lelink-admin
└─ 检查端口：netstat -tulpn | grep 3000
└─ 重启PM2：pm2 restart all

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📞 需要帮助
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

如果遇到问题，请提供：
1. 错误信息截图
2. 执行哪一步出错
3. pm2 logs 的输出

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

预计总耗时：5-10分钟

